import{_ as xe,e as l,j as re,g as Le,G as R,H as v,l as ie,f as ze,c,a as t,i as D,b as r,w as u,T as ee,F as g,h as E,p as $,u as Be,r as ce,o as i,t as Fe,n as Ne,q as ue,I as de,d as H,J as ve,m as me}from"./index-fcc907de.js";import{u as Ae}from"./index-506edf4d.js";import{g as U}from"./images-43df9302.js";import{W as fe,B as De}from"./BackToTop-57c6e706.js";import"./request-1f02c5f8.js";const $e={class:"home-container"},He={class:"banner"},Ue={class:"banner-content"},Ge={class:"slogan-container"},Ve={class:"banner-backgrounds"},je={class:"wallpaper-section"},Oe={class:"container"},Pe={class:"section-header"},qe={class:"header-buttons"},Je={key:0,class:"loading-container"},Ke={class:"loading-animation"},Ye={class:"wallpaper-section"},Qe={class:"container"},Xe={class:"section-header"},Ze={class:"header-buttons"},ea={key:0,class:"loading-container"},aa={class:"loading-animation"},pe=3,ae="lastBannerImageData",ta={__name:"Home",setup(sa){const d=Be(),G=Ae(),h=l([]),_=l([]),f=l(!0),p=l(!0),M=l(!1),x=l(!1),w=l(!1),y=l(null),b=l(null),V=l(null),j=l(null),O=l(4),P=l(4),L=re(()=>{const a=Math.max(O.value,1),e=pe,n=8;let o=a*e;if(o<n){const s=Math.ceil(n/a);o=a*s}return o}),z=re(()=>{const a=Math.max(P.value,1),e=pe,n=8;let o=a*e;if(o<n){const s=Math.ceil(n/a);o=a*s}return o}),q=new AbortController,J=new AbortController,k=l(null),C=l(null),B=l(!0),S=["é«˜æ¸…å£çº¸ï¼Œè®©æ‚¨çš„è®¾å¤‡ä¸Žä¼—ä¸åŒ","ç²¾é€‰å£çº¸ï¼Œå±•çŽ°ç‹¬ç‰¹å“å‘³","æµ·é‡èµ„æºï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆæ‚¨","æ¯æ—¥æ›´æ–°ï¼Œå¸¦ç»™æ‚¨æ–°é²œè§†è§‰ä½“éªŒ","ç®€çº¦è‡³ç¾Žï¼Œä¸ºæ‚¨çš„è®¾å¤‡é”¦ä¸Šæ·»èŠ±","å“è´¨å£çº¸ï¼Œæå‡æ‚¨çš„è§†è§‰äº«å—","å£çº¸å¦‚ç”»ï¼Œç¾Žåœ¨æ¯ä¸€æ¬¡ç‚¹äº®ä¹‹é—´","å‘çŽ°ç¾Žå¥½ï¼Œä»Žä¸€å¼ å£çº¸å¼€å§‹","ä¸æ­¢äºŽç¾Žï¼Œæ›´æ˜¯å“å‘³çš„è¡¨è¾¾","ç„•æ–°å£çº¸ï¼Œè®©ç¾Žä»Žè¿™ä¸€åˆ»å¼€å§‹","é£Žæ ¼ç™¾å˜ï¼Œå½°æ˜¾ä¸“å±žä¸ªæ€§"],F=l(S[0]),m=l([{id:0,url:"",active:!0},{id:1,url:"",active:!1}]),I=l(0),ge=()=>window.innerWidth>window.innerHeight;Le(()=>{q.abort(),J.abort(),window.removeEventListener("resize",te),A(),m.value.forEach(a=>{a.url&&a.url.startsWith("blob:")&&URL.revokeObjectURL(a.url)}),y.value&&clearTimeout(y.value)});let K=null;const te=()=>{K&&clearTimeout(K),K=setTimeout(()=>{N()},200)},N=()=>{R(()=>{if(V.value){const a=V.value.offsetWidth;let e=320;window.innerWidth<=768&&(e=180);const n=Math.max(Math.floor(a/e),1);n!==O.value&&(O.value=n,!f.value&&h.value.length>0&&h.value.length<L.value&&Y())}if(j.value){const a=j.value.offsetWidth;let e=240;window.innerWidth<=768&&(e=180);const n=Math.max(Math.floor(a/e),1);n!==P.value&&(P.value=n,!p.value&&_.value.length>0&&_.value.length<z.value&&Q())}})},he=()=>{R(()=>{setTimeout(()=>{N()},300)})},Y=async()=>{f.value=!0;try{const a={current:1,pageSize:L.value,isLandscape:!0,isNsfw:!1,auditStatus:1,processingStatus:2,orderField:"random",orderType:"desc"},e=await U(a,q.signal);e.code===200&&e.success?(h.value=e.data.records||[],R(()=>{N()})):v.error("èŽ·å–ç”µè„‘å£çº¸å¤±è´¥")}catch(a){(!a.name||a.name!=="AbortError")&&v.error("èŽ·å–ç”µè„‘å£çº¸å¤±è´¥")}finally{f.value=!1}},Q=async()=>{p.value=!0;try{const a={current:1,pageSize:z.value,isLandscape:!1,isNsfw:!1,auditStatus:1,processingStatus:2,orderField:"random",orderType:"desc"},e=await U(a,J.signal);e.code===200&&e.success?(_.value=e.data.records||[],R(()=>{N()})):v.error("èŽ·å–æ‰‹æœºå£çº¸å¤±è´¥")}catch(a){(!a.name||a.name!=="AbortError")&&v.error("èŽ·å–æ‰‹æœºå£çº¸å¤±è´¥")}finally{p.value=!1}},se=a=>{G.isFavorite(a)?G.removeFavorite(a):G.addFavorite(a)},oe=a=>{d.push(`/gallery/image/${a}`)},_e=()=>{d.push("/desktop-wallpaper")},we=()=>{d.push("/mobile-wallpaper")};ie(L,(a,e)=>{a!==e&&!f.value&&Y()},{immediate:!1}),ie(z,(a,e)=>{a!==e&&!p.value&&Q()},{immediate:!1});const T=async()=>{try{const a=window.location.origin,e=ge(),n=`${a}/api/image/random?isNsfw=false&isLandscape=${e}&t=${Date.now()}`;fetch(n).then(o=>{if(!o.ok)throw new Error(`è¯·æ±‚å¤±è´¥: ${o.status}`);return o.blob()}).then(o=>{const s=URL.createObjectURL(o),W=I.value===0?1:0;m.value[W].url=s,m.value[I.value].active=!1,m.value[W].active=!0,I.value=W;const Z=new FileReader;Z.readAsDataURL(o),Z.onloadend=()=>{const Ee=Z.result;try{localStorage.setItem(ae,Ee)}catch(Me){console.error("Error saving image to localStorage:",Me),localStorage.removeItem(ae)}}}).catch(o=>{console.error("èŽ·å–å£çº¸å¤±è´¥ï¼Œä¿ç•™å½“å‰å£çº¸:",o)})}catch(a){console.error("èŽ·å–å£çº¸å¤±è´¥ï¼Œä¿ç•™å½“å‰å£çº¸:",a)}},ye=()=>{const a=localStorage.getItem(ae);if(a)try{m.value[I.value].url=a,m.value[I.value].active=!0}catch(e){console.error("Error loading cached image data:",e),T()}else T()},A=()=>{k.value&&(clearInterval(k.value),k.value=null),C.value&&(clearInterval(C.value),C.value=null),b.value&&(clearInterval(b.value),b.value=null)},le=()=>{A(),k.value=setInterval(()=>{T()},15e3),C.value=setInterval(X,1e4),b.value=setInterval(()=>{ne()},5e3)},be=()=>{ye(),B.value&&(k.value=setInterval(()=>{T()},15e3))},ke=()=>{X(),B.value&&(C.value=setInterval(X,1e4))},Ce=()=>{B.value&&(b.value=setInterval(()=>{ne()},5e3))},X=()=>{const a=S.indexOf(F.value);let e;do e=Math.floor(Math.random()*S.length);while(e===a&&S.length>1);F.value=S[e]},ne=()=>{w.value=!0,y.value=setTimeout(()=>{w.value=!1},2e3)},Se=()=>{w.value=!1,y.value&&clearTimeout(y.value)},Ie=()=>{const a=d.currentRoute.value.path==="/"||d.currentRoute.value.path==="/home";B.value=a,a?le():A()},Te=()=>{document.hidden?A():(d.currentRoute.value.path==="/"||d.currentRoute.value.path==="/home")&&le()};ze(()=>{he(),window.addEventListener("resize",te),Y(),Q(),be(),ke(),Ce(),d.beforeEach((a,e,n)=>{n(),R(()=>{Ie()})}),document.addEventListener("visibilitychange",Te)}),window.addEventListener("orientationchange",()=>{T()});const We=async()=>{if(!M.value){M.value=!0;try{const a={current:1,pageSize:L.value,isLandscape:!0,isNsfw:!1,auditStatus:1,processingStatus:2,orderField:"random",orderType:"desc"},e=await U(a,q.signal);e.code===200&&e.success?setTimeout(()=>{h.value=e.data.records||[]},50):v.error("èŽ·å–éšæœºå£çº¸å¤±è´¥")}catch(a){(!a.name||a.name!=="AbortError")&&v.error("èŽ·å–éšæœºå£çº¸å¤±è´¥")}finally{M.value=!1}}},Re=async()=>{if(!x.value){x.value=!0;try{const a={current:1,pageSize:z.value,isLandscape:!1,isNsfw:!1,auditStatus:1,processingStatus:2,orderField:"random",orderType:"desc"},e=await U(a,J.signal);e.code===200&&e.success?setTimeout(()=>{_.value=e.data.records||[]},50):v.error("èŽ·å–éšæœºå£çº¸å¤±è´¥")}catch(a){(!a.name||a.name!=="AbortError")&&v.error("èŽ·å–éšæœºå£çº¸å¤±è´¥")}finally{x.value=!1}}};return(a,e)=>{const n=ce("el-icon"),o=ce("el-button");return i(),c(g,null,[t("div",$e,[t("section",He,[t("div",Ue,[t("h1",{class:D(["glitch-text",{"glitch-active":w.value}]),onMouseenter:e[0]||(e[0]=s=>w.value=!0),onMouseleave:e[1]||(e[1]=s=>Se())},"æ‹é£Žå£çº¸",34),e[2]||(e[2]=t("div",{class:"title-underline"},null,-1)),t("div",Ge,[r(ee,{name:"fade-slogan",mode:"out-in"},{default:u(()=>[(i(),c("p",{key:F.value},Fe(F.value),1))]),_:1})])]),t("div",Ve,[(i(!0),c(g,null,E(m.value,s=>(i(),c("div",{key:s.id,class:D(["banner-background",{active:s.active}]),style:Ne({backgroundImage:s.url?`url(${s.url})`:"linear-gradient(135deg, var(--color-primary-light), var(--color-primary), var(--color-primary-dark), var(--color-primary), var(--color-primary-light))"})},null,6))),128))]),e[3]||(e[3]=t("div",{class:"banner-overlay"},null,-1)),e[4]||(e[4]=t("div",{class:"banner-wave-container"},[t("div",{class:"banner-wave wave1"}),t("div",{class:"banner-wave wave2"})],-1))]),t("section",je,[t("div",Oe,[t("div",Pe,[e[7]||(e[7]=t("h2",null,"ç”µè„‘å£çº¸",-1)),t("div",qe,[r(o,{type:"default",class:"refresh-btn",onClick:We},{default:u(()=>[r(n,{class:D({"is-loading":M.value})},{default:u(()=>[r(ue(de))]),_:1},8,["class"]),e[5]||(e[5]=H(" æ¢ä¸€æ¢ "))]),_:1}),r(o,{type:"primary",onClick:_e},{default:u(()=>e[6]||(e[6]=[H("æŸ¥çœ‹æ›´å¤š")])),_:1})])]),f.value?(i(),c("div",Je,[t("div",Ke,[(i(),c(g,null,E(4,s=>t("div",{key:s,class:"loading-item"})),64))])])):$("",!0),r(ee,{name:"fade"},{default:u(()=>[f.value?$("",!0):(i(),c("div",{key:0,class:"wallpaper-grid desktop-grid",ref_key:"desktopContainer",ref:V},[r(ve,{name:"flip-list"},{default:u(()=>[(i(!0),c(g,null,E(h.value,s=>(i(),me(fe,{key:s.id,image:s,onClick:W=>oe(s.id),onFavorite:se,class:"wallpaper-item"},null,8,["image","onClick"]))),128))]),_:1})],512))]),_:1})])]),t("section",Ye,[t("div",Qe,[t("div",Xe,[e[10]||(e[10]=t("h2",null,"æ‰‹æœºå£çº¸",-1)),t("div",Ze,[r(o,{type:"default",class:"refresh-btn",onClick:Re},{default:u(()=>[r(n,{class:D({"is-loading":x.value})},{default:u(()=>[r(ue(de))]),_:1},8,["class"]),e[8]||(e[8]=H(" æ¢ä¸€æ¢ "))]),_:1}),r(o,{type:"primary",onClick:we},{default:u(()=>e[9]||(e[9]=[H("æŸ¥çœ‹æ›´å¤š")])),_:1})])]),p.value?(i(),c("div",ea,[t("div",aa,[(i(),c(g,null,E(4,s=>t("div",{key:s,class:"loading-item"})),64))])])):$("",!0),r(ee,{name:"fade"},{default:u(()=>[p.value?$("",!0):(i(),c("div",{key:0,class:"wallpaper-grid mobile-grid",ref_key:"mobileContainer",ref:j},[r(ve,{name:"flip-list"},{default:u(()=>[(i(!0),c(g,null,E(_.value,s=>(i(),me(fe,{key:s.id,image:s,onClick:W=>oe(s.id),onFavorite:se,class:"wallpaper-item"},null,8,["image","onClick"]))),128))]),_:1})],512))]),_:1})])])]),r(De,{scrollDuration:800,visibilityHeight:200})],64)}}},ca=xe(ta,[["__scopeId","data-v-3153959e"]]);export{ca as default};